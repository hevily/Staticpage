<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <!-- <link rel="stylesheet" type="text/css" href="/statichtml/moviehelper/app/Public/base.css" /> -->
    <!-- <link rel="stylesheet" type="text/css" href="../css/" /> -->
    <title>下拉加载更多</title>
</head>
<body>
    <header></header>
    <div class="container">
        <div class="section">
            <p>1</p>
            <p>2</p>
            <p>3</p>
            <p>4</p>
            <p>5</p>
            <p>6</p>
            <p>7</p>
            <p>8</p>
            <p>9</p>
            <p>10</p>
            <p>11</p>
            <p>12</p>
            <p>13</p>
            <p>14</p>
            <p>15</p>
            <p>16</p>
            <p>17</p>
            <p>18</p>
            <p>19</p>
            <p>20</p>
            <p>21</p>
            <p>22</p>
            <p>23</p>
            <p>24</p>
            <p>25</p>
            <p>26</p>
            <p>27</p>
            <p>28</p>
            <p>29</p>
            <p>30</p>
        </div>
        <div class="section">

        </div>
    </div>
    <footer></footer>
    <script src="http://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script type="text/javascript">
        $(function () {
            // scrollBottomLoadMore({offtop,callback})
            var i = 30;
            var timeout //使用前全局声明一个timeout

            $(window).scroll(function () {

                scrollBottomLoadMore({ // 使用范例
                    offtop:110, //配置距离顶部距离
                    callback:function () { //触发加载时需要做什么
                        console.log('do something 加载更多')
                        $('body').append("<p>"+i+"</p><p>"+(i+1)+"</p>")
                        i+=2;
                    }
                });

            })

            function scrollBottomLoadMore(option) {
                option.offtop ? offtop = option.offtop : offtop = 10 //初始化距离顶部距离
                option.timeoffset ? timeoffset = option.timeoffset : timeoffset = 100 //初始化延时时间
                callback = option.callback
                var stop = true
                clearInterval(timeout);
            // occur a delay
                timeout = setTimeout(function(){
                        var docHeight = $(document).height();
                        var scrollheight = parseFloat($(window).height()) + parseFloat($(window).scrollTop() + offtop);
                        if(docHeight <= scrollheight){ //靠近加载区域
                            if(stop==true){
                                stop=false;
                            if ( callback ) {
                                callback()
                            }else{
                                console.log('未执行任何操作')
                            }
                                stop=true;
                            }
                        }else{ // 未到达加载区域

                            console.log('keep moving')
                        }
                },timeoffset)
            }
        })
    </script>
</body>
</html>